---
title: "capstone"
author: "KuanCheng"
date: "2024-09-29"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(foreign)
library(tidyverse)
library(ggplot2)
library("dplyr")
library("ggpubr")
```

#Collected data from each cohort of NHANES Demographic Variables, Body Measures, Medical Conditions and Smoking - Cigarette Use dataset.
#Loading the raw data files, extension is where it currently is
```{r}
demography = "DEMO_1112.XPT" # Demographic Variables
demography = read.xport(demography)

body = "body_1112.XPT" # Body Measures
body = read.xport(body)

condition = "condition_1112.XPT" # Medical Conditions
condition = read.xport(condition) 

smoke = "smoke_1112.XPT" # Smoking - Cigarette Use
smoke = read.xport(smoke)
```

#GENDER, AGE, ever smoke, started smoking, Do now smoke cigarettes, How long since quit smoking, Ever have asthma, Age first had asthma, 
#Still have asthma, Ever had emphysema, Age had emphysema, Ever had chronic bronchitis, still have chronic bronchitis
#Close relative had asthma?
```{r}
total <- merge(demography,condition,by="SEQN")
total_1 <- merge(total, smoke,by="SEQN")
total_2 <- merge(total_1, body, by="SEQN")
df_1112 <- total_2[c("SEQN","RIAGENDR", "RIDAGEYR", "SMQ020","SMD030","SMQ040","SMQ050Q", "MCQ010",
                "MCQ160G", "MCQ160K", "MCQ300B", "BMXBMI", "INDFMPIR","DMDEDUC2")]
df_1112_2 = df_1112[complete.cases( df_1112[ ,c("MCQ010", "MCQ160G", "MCQ160K")]),]
df_1112_2$BMI <- cut(df_1112_2$BMXBMI, breaks = c(0,18.5,25,30,40,100), labels = c("1","2","3","4", "5"))
```


#year 1314
```{r}
demo_1314 = "demo_1314.XPT"
demo_1314 = read.xport(demo_1314)

body_1314 = "body_1314.XPT"
body_1314 = read.xport(body_1314)

condition_1314 = "condition_1314.XPT"
condition_1314 = read.xport(condition_1314)

smoke_1314 = "smoke_1314.XPT"
smoke_1314 = read.xport(smoke_1314)

m1314_1 = merge(demo_1314, body_1314, by="SEQN")
m1314_2 = merge(m1314_1, condition_1314,by="SEQN")
m1314_3 = merge(m1314_2, smoke_1314,by="SEQN")

df_1314 = m1314_3[c("SEQN","RIAGENDR", "RIDAGEYR", "SMQ020","SMD030","SMQ040","SMQ050Q", "MCQ010",
                "MCQ160G", "MCQ160K", "MCQ300B", "BMXBMI", "INDFMPIR","DMDEDUC2")]
df_1314_2 = df_1314[complete.cases( df_1314[ ,c("MCQ010", "MCQ160G", "MCQ160K")]),]
df_1314_2$BMI <- cut(df_1314_2$BMXBMI, breaks = c(0,18.5, 25, 30, 40,100), labels = c("1","2","3","4", "5"))
```

#year 1516
```{r}
demo_1516 = "demo_1516.XPT"
demo_1516 = read.xport(demo_1516)

body_1516 = "body_1516.XPT"
body_1516 = read.xport(body_1516)

condition_1516 = "condition_1516.XPT"
condition_1516 = read.xport(condition_1516)

smoke_1516 = "smoke_1516.XPT"
smoke_1516 = read.xport(smoke_1516)

m1516_1 = merge(demo_1516, body_1516, by="SEQN")
m1516_2 = merge(m1516_1, condition_1516,by="SEQN")
m1516_3 = merge(m1516_2, smoke_1516,by="SEQN")

df_1516 = m1516_3[c("SEQN","RIAGENDR", "RIDAGEYR", "SMQ020","SMD030","SMQ040","SMQ050Q", "MCQ010",
                "MCQ160G", "MCQ160K", "MCQ300B", "BMXBMI", "INDFMPIR","DMDEDUC2")]
df_1516_2 = df_1516[complete.cases( df_1516[ ,c("MCQ010", "MCQ160G", "MCQ160K")]),]
df_1516_2$BMI <- cut(df_1516_2$BMXBMI, breaks = c(0,18.5, 25, 30, 40,100), labels = c("1","2","3","4", "5"))
```

#year 1718
```{r}
demo_1718 = "demo_1718.XPT"
demo_1718 = read.xport(demo_1718)

body_1718 = "body_1718.XPT"
body_1718 = read.xport(body_1718)

condition_1718 = "condition_1718.XPT"
condition_1718 = read.xport(condition_1718)

smoke_1718 = "smoke_1718.XPT"
smoke_1718 = read.xport(smoke_1718)

m1718_1 = merge(demo_1718, body_1718, by="SEQN")
m1718_2 = merge(m1718_1, condition_1718,by="SEQN")
m1718_3 = merge(m1718_2, smoke_1718,by="SEQN")

df_1718 = m1718_3[c("SEQN","RIAGENDR", "RIDAGEYR", "SMQ020","SMD030","SMQ040","SMQ050Q", "MCQ010",
                "MCQ160G", "MCQ160K", "MCQ300B", "BMXBMI", "INDFMPIR","DMDEDUC2")]
df_1718_2 = df_1718[complete.cases(df_1718[ ,c("MCQ010", "MCQ160G", "MCQ160K")]),]
df_1718_2$BMI <- cut(df_1718_2$BMXBMI, breaks = c(0,18.5, 25, 30, 40,100), labels = c("1","2","3","4", "5"))
```
#count data valid / total
```{r}
# total
df_1112 # 6549
df_1314 # 6979
df_1516 # 6744
df_1718 # 6401

# valid
df_1112_2 # 5318
df_1314_2 # 5588
df_1516_2 # 5474
df_1718_2 # 5265
```

#combine the year data
```{r}
df <- rbind(df_1314_2, df_1112_2)
df1 <- rbind(df, df_1516_2)
df2 <- rbind(df1, df_1718_2)
```

```{r}
df_1314_2 %>% filter(MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)
df_1112_2 %>% filter(MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)
df_1516_2 %>% filter(MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)
df_1718_2 %>% filter(MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)

df2 %>% filter(MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)
# poverty level
df2$PLevel_ = cut(df2$INDFMPIR, breaks = c(0,1.5, 4, 6), labels = c("Low", "Medium", "High"))
df2$PLEVEL = cut(df2$INDFMPIR, breaks = c(0,1.5, 4, 6), labels = c(1, 2, 3))
# group it to Less than High School (Group 1), High School Graduate (Group 2), College Graduate (Group 3), and Postgraduate Degree (Group 4)
df2$edu_ <- factor(df2$DMDEDUC2, levels = c(1, 2, 3, 4, 5), labels = c("Under High School", "Under High School", 
                                   "High School Graduate", "College Graduate", "Postgraduate Degree"))
# disease condition
df2 <- df2 %>% mutate(is_disease = case_when(
  MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1 ~ 1,
  MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2 ~ 0
))
# smoke condition
df2 <- df2 %>% mutate(smoke_ = case_when(
  SMQ020 == 2 ~ "Never",
  SMQ040 == 3 & SMQ020 == 1 ~ "Quit",
  SMQ040 == 1 | SMQ040 == 2 ~ "Now"
))
df3 <- df2[complete.cases(df2[,c("is_disease", "RIDAGEYR", "BMXBMI", "edu_", "PLevel_", "smoke_")]),]
```
#age distribution
```{r}
# check age distribution. set 20-39, 40-59, 60-80 three groups.
summary(df2$RIDAGEYR)

# plot distribution in percentage
df2$age_group <- cut(df2$RIDAGEYR, breaks = c(20, 39, 59, 80), labels = c("20-39", "40-59", "60-80"), right = TRUE)

age_distribution <- prop.table(table(df2$age_group)) * 100
barplot(age_distribution, main = "Age Distribution", xlab = "Age Group", ylab = "Percentage (%)", ylim = c(0, 40))

```
#age filter
```{r}
df2 %>% filter(age_group == "20-39" & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) #group1
df2 %>% filter(age_group == "20-39" & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)

df2 %>% filter(age_group == "40-59" & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) #group2
df2 %>% filter(age_group == "40-59" & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)

df2 %>% filter(age_group == "60-80" & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) #group3
df2 %>% filter(age_group == "60-80" & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
```



#gender filter
```{r}
df2 %>% filter(MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1) #Total ever disease
df2 %>% filter(MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)

df2 %>% filter(RIAGENDR == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter(RIAGENDR == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(RIAGENDR == 1) #Total male

df2 %>% filter(RIAGENDR == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter(RIAGENDR == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(RIAGENDR == 2) #Total female

```

#smoke filter
```{r}
df2 %>% filter(SMQ020 == 2) # Never smoke
df2 %>% filter(SMQ020 == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # Never smoke have disease
df2 %>% filter(SMQ020 == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) 

df2 %>% filter(SMQ040 == 1 | SMQ040 == 2)
df2 %>% filter((SMQ040 == 1 | SMQ040 == 2) & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # now smoke have disease
df2 %>% filter((SMQ040 == 1 | SMQ040 == 2) & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) 

df2 %>% filter(SMQ040 == 3  & SMQ020 == 1)
df2 %>% filter(SMQ040 == 3 & SMQ020 == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # quit have disease
df2 %>% filter(SMQ040 == 3 & SMQ020 == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) 
```

#Gender smoke
```{r}
df2 %>% filter(RIAGENDR == 1 & SMQ020 == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # Male Never smoke have disease
df2 %>% filter(RIAGENDR == 1 & SMQ020 == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # Male Never smoke no disease

df2 %>% filter(RIAGENDR == 1 & SMQ040 == 3 & SMQ020 == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # Male quit have disease
df2 %>% filter(RIAGENDR == 1 & SMQ040 == 3 & SMQ020 == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # Male quit no disease

df2 %>% filter(RIAGENDR == 1 & (SMQ040 == 1 | SMQ040 == 2) & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # Male now smoke have disease
df2 %>% filter(RIAGENDR == 1 & (SMQ040 == 1 | SMQ040 == 2) & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # Male now smoke no disease

df2 %>% filter(RIAGENDR == 2 & SMQ020 == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # Female Never smoke have disease
df2 %>% filter(RIAGENDR == 2 & SMQ020 == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # Female Never smoke no disease

df2 %>% filter(RIAGENDR == 2 & SMQ040 == 3 & SMQ020 == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # Female quit have disease
df2 %>% filter(RIAGENDR == 2 & SMQ040 == 3 & SMQ020 == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # Female quit no disease

df2 %>% filter(RIAGENDR == 2 & (SMQ040 == 1 | SMQ040 == 2) & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # Female now smoke have disease
df2 %>% filter(RIAGENDR == 2 & (SMQ040 == 1 | SMQ040 == 2) & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # Female now smoke no disease
```

```{r}
df2 %>% filter((DMDEDUC2 == 1 | DMDEDUC2 == 2) & SMQ020 == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # Less than high school ever smoke have disease
df2 %>% filter((DMDEDUC2 == 1 | DMDEDUC2 == 2) & SMQ020 == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # Less than high school ever smoke no disease

df2 %>% filter((DMDEDUC2 == 1 | DMDEDUC2 == 2) & (SMQ040 == 1 | SMQ040 == 2) & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) #  Less than high school now smoke have disease
df2 %>% filter((DMDEDUC2 == 1 | DMDEDUC2 == 2) & (SMQ040 == 1 | SMQ040 == 2) & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) #  Less than high school now smoke no disease

df2 %>% filter((DMDEDUC2 == 1 | DMDEDUC2 == 2) & SMQ040 == 3 & SMQ020 == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) #  Less than high school quit have disease
df2 %>% filter((DMDEDUC2 == 1 | DMDEDUC2 == 2) & SMQ040 == 3 & SMQ020 == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) #  Less than high school quit no disease

df2 %>% filter(DMDEDUC2 == 3 & (SMQ040 == 1 | SMQ040 == 2) & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # High school graduate now smoke have disease
df2 %>% filter(DMDEDUC2 == 3 & (SMQ040 == 1 | SMQ040 == 2) & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # High school graduate now smoke no disease

df2 %>% filter(DMDEDUC2 == 3 & SMQ040 == 3 & SMQ020 == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # High school graduate quit have disease
df2 %>% filter(DMDEDUC2 == 3 & SMQ040 == 3 & SMQ020 == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # High school graduate quit no disease

df2 %>% filter(DMDEDUC2 == 3 & SMQ020 == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # High school graduate ever smoke have disease
df2 %>% filter(DMDEDUC2 == 3 & SMQ020 == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # High school graduate  ever smoke no disease

df2 %>% filter(DMDEDUC2 == 4 & (SMQ040 == 1 | SMQ040 == 2) & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # College graduate now smoke have disease
df2 %>% filter(DMDEDUC2 == 4 & (SMQ040 == 1 | SMQ040 == 2) & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # College graduate now smoke have disease

df2 %>% filter(DMDEDUC2 == 4 & SMQ040 == 3 & SMQ020 == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # College graduate quit have disease
df2 %>% filter(DMDEDUC2 == 4 & SMQ040 == 3 & SMQ020 == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # College graduate quit have disease

df2 %>% filter(DMDEDUC2 == 4 & SMQ020 == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # College graduate Never smoke have disease
df2 %>% filter(DMDEDUC2 == 4 & SMQ020 == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # College graduate Never smoke have disease

df2 %>% filter(DMDEDUC2 == 5 & (SMQ040 == 1 | SMQ040 == 2) & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # Postgraduate degree now smoke have disease
df2 %>% filter(DMDEDUC2 == 5 & (SMQ040 == 1 | SMQ040 == 2) & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # Postgraduate degree now smoke have disease

df2 %>% filter(DMDEDUC2 == 5 & SMQ040 == 3 & SMQ020 == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # Postgraduate degree quit have disease
df2 %>% filter(DMDEDUC2 == 5 & SMQ040 == 3 & SMQ020 == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # Postgraduate degree quit have disease

df2 %>% filter(DMDEDUC2 == 5 & SMQ020 == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # Postgraduate degree Never smoke have disease
df2 %>% filter(DMDEDUC2 == 5 & SMQ020 == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # Postgraduate degree Never smoke have disease

```

```{r}
df2 %>% filter((DMDEDUC2 == 1 | DMDEDUC2 == 2) & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter((DMDEDUC2 == 1 | DMDEDUC2 == 2) & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(DMDEDUC2 == 1 | DMDEDUC2 == 2)

df2 %>% filter(DMDEDUC2 == 3 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter(DMDEDUC2 == 3 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(DMDEDUC2 == 3)

df2 %>% filter(DMDEDUC2 == 4 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter(DMDEDUC2 == 4 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(DMDEDUC2 == 4)

df2 %>% filter(DMDEDUC2 == 5 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter(DMDEDUC2 == 5 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(DMDEDUC2 == 5)
```

#BMI filter
```{r}
df2 %>% filter(BMI == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter(BMI == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(BMI == 1)

df2 %>% filter(BMI == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter(BMI == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(BMI == 2)

df2 %>% filter(BMI == 3 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter(BMI == 3 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(BMI == 3)

df2 %>% filter(BMI == 4 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter(BMI == 4 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(BMI == 4)

df2 %>% filter(BMI == 5 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter(BMI == 5 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(BMI == 5)
```

#Poverty filter
```{r}
df2 %>% filter(PLEVEL == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter(PLEVEL == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(PLEVEL == 1)

df2 %>% filter(PLEVEL == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter(PLEVEL == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(PLEVEL == 2)

df2 %>% filter(PLEVEL == 3 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter(PLEVEL == 3 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(PLEVEL == 3)
```

#Poverty smoke disease filter
```{r}
df2 %>% filter(PLEVEL == 1 & (SMQ040 == 1 | SMQ040 == 2) & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # now smoke have disease
df2 %>% filter(PLEVEL == 1 & (SMQ040 == 1 | SMQ040 == 2) & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # now smoke no disease

df2 %>% filter(PLEVEL == 1 & SMQ040 == 3 & SMQ020 == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # quit have disease
df2 %>% filter(PLEVEL == 1 & SMQ040 == 3 & SMQ020 == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # quit no disease

df2 %>% filter(PLEVEL == 1 & SMQ020 == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # Never smoke have disease
df2 %>% filter(PLEVEL == 1 & SMQ020 == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # Never smoke no disease

df2 %>% filter(PLEVEL == 2 & (SMQ040 == 1 | SMQ040 == 2) & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # now smoke have disease
df2 %>% filter(PLEVEL == 2 & (SMQ040 == 1 | SMQ040 == 2) & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # now smoke no disease

df2 %>% filter(PLEVEL == 2 & SMQ040 == 3 & SMQ020 == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # quit have disease
df2 %>% filter(PLEVEL == 2 & SMQ040 == 3 & SMQ020 == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # quit no disease

df2 %>% filter(PLEVEL == 2 & SMQ020 == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # Never smoke have disease
df2 %>% filter(PLEVEL == 2 & SMQ020 == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # Never smoke no disease

df2 %>% filter(PLEVEL == 3 & (SMQ040 == 1 | SMQ040 == 2) & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # now smoke have disease
df2 %>% filter(PLEVEL == 3 & (SMQ040 == 1 | SMQ040 == 2) & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # now smoke no disease

df2 %>% filter(PLEVEL == 3 & SMQ040 == 3 & SMQ020 == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # quit have disease
df2 %>% filter(PLEVEL == 3 & SMQ040 == 3 & SMQ020 == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # quit no disease

df2 %>% filter(PLEVEL == 3 & SMQ020 == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # Never smoke have disease
df2 %>% filter(PLEVEL == 3 & SMQ020 == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) # Never smoke no disease
```

#edu filter
```{r}
df2 %>% filter((DMDEDUC2 == 1 | DMDEDUC2 == 2) & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter((DMDEDUC2 == 1 | DMDEDUC2 == 2) & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(DMDEDUC2 == 1 | DMDEDUC2 == 2)

df2 %>% filter(DMDEDUC2 == 3 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter(DMDEDUC2 == 3 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(DMDEDUC2 == 3)

df2 %>% filter(DMDEDUC2 == 4 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter(DMDEDUC2 == 4 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(DMDEDUC2 == 4)

df2 %>% filter(DMDEDUC2 == 5 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1))
df2 %>% filter(DMDEDUC2 == 5 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)
df2 %>% filter(DMDEDUC2 == 5)
```



#BMI filter
```{r}
df2 %>% filter(BMI == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1) & (SMQ040 == 1 | SMQ040 == 2)) #BMI = 1, now smoke, have disease
df2 %>% filter(BMI == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2 & (SMQ040 == 1 | SMQ040 == 2)) #BMI = 1, now smoke, no disease
df2 %>% filter(BMI == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1) & SMQ040 == 3 & SMQ020 == 1) #BMI = 1, quit smoke, have disease
df2 %>% filter(BMI == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2 & SMQ040 == 3 & SMQ020 == 1) #BMI = 1, quit smoke, no disease
df2 %>% filter(BMI == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1) & SMQ020 == 2) #BMI = 1, never smoke, have disease
df2 %>% filter(BMI == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2 & SMQ020 == 2) #BMI = 1, never smoke, no disease
df2 %>% filter(BMI == 1 & (SMQ040 == 1 | SMQ040 == 2))
df2 %>% filter(BMI == 1 & SMQ040 == 3 & SMQ020 == 1)
df2 %>% filter(BMI == 1 & SMQ020 == 2)

df2 %>% filter(BMI == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1) & (SMQ040 == 1 | SMQ040 == 2)) #BMI = 2, now smoke, have disease
df2 %>% filter(BMI == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2 & (SMQ040 == 1 | SMQ040 == 2)) #BMI = 2, now smoke, no disease
df2 %>% filter(BMI == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1) & SMQ040 == 3 & SMQ020 == 1) #BMI = 2, quit smoke, have disease
df2 %>% filter(BMI == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2 & SMQ040 == 3 & SMQ020 == 1) #BMI = 2, quit smoke, no disease
df2 %>% filter(BMI == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1) & SMQ020 == 2) #BMI = 2, never smoke, have disease
df2 %>% filter(BMI == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2 & SMQ020 == 2) #BMI = 2, never smoke, no disease
df2 %>% filter(BMI == 2 & (SMQ040 == 1 | SMQ040 == 2))
df2 %>% filter(BMI == 2 & SMQ040 == 3 & SMQ020 == 1)
df2 %>% filter(BMI == 2 & SMQ020 == 2)

df2 %>% filter(BMI == 3 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1) & (SMQ040 == 1 | SMQ040 == 2)) #BMI = 3, now smoke, have disease
df2 %>% filter(BMI == 3 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2 & (SMQ040 == 1 | SMQ040 == 2)) #BMI = 3, now smoke, no disease
df2 %>% filter(BMI == 3 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1) & SMQ040 == 3 & SMQ020 == 1) #BMI = 3, quit smoke, have disease
df2 %>% filter(BMI == 3 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2 & SMQ040 == 3 & SMQ020 == 1) #BMI = 3, quit smoke, no disease
df2 %>% filter(BMI == 3 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1) & SMQ020 == 2) #BMI = 3, never smoke, have disease
df2 %>% filter(BMI == 3 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2 & SMQ020 == 2) #BMI = 3, never smoke, no disease
df2 %>% filter(BMI == 3 & (SMQ040 == 1 | SMQ040 == 2))
df2 %>% filter(BMI == 3 & SMQ040 == 3 & SMQ020 == 1)
df2 %>% filter(BMI == 3 & SMQ020 == 2)

df2 %>% filter(BMI == 4 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1) & (SMQ040 == 1 | SMQ040 == 2)) #BMI = 4, now smoke, have disease
df2 %>% filter(BMI == 4 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2 & (SMQ040 == 1 | SMQ040 == 2)) #BMI = 4, now smoke, no disease
df2 %>% filter(BMI == 4 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1) & SMQ040 == 3 & SMQ020 == 1) #BMI = 4, quit smoke, have disease
df2 %>% filter(BMI == 4 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2 & SMQ040 == 3 & SMQ020 == 1) #BMI = 4, quit smoke, no disease
df2 %>% filter(BMI == 4 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1) & SMQ020 == 2) #BMI = 4, never smoke, have disease
df2 %>% filter(BMI == 4 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2 & SMQ020 == 2) #BMI = 4, never smoke, no disease
df2 %>% filter(BMI == 4 & (SMQ040 == 1 | SMQ040 == 2))
df2 %>% filter(BMI == 4 & SMQ040 == 3 & SMQ020 == 1)
df2 %>% filter(BMI == 4 & SMQ020 == 2)

df2 %>% filter(BMI == 5 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1) & (SMQ040 == 1 | SMQ040 == 2)) #BMI = 5, now smoke, have disease
df2 %>% filter(BMI == 5 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2 & (SMQ040 == 1 | SMQ040 == 2)) #BMI = 5, now smoke, no disease
df2 %>% filter(BMI == 5 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1) & SMQ040 == 3 & SMQ020 == 1) #BMI = 5, quit smoke, have disease
df2 %>% filter(BMI == 5 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2 & SMQ040 == 3 & SMQ020 == 1) #BMI = 5, quit smoke, no disease
df2 %>% filter(BMI == 5 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1) & SMQ020 == 2) #BMI = 5, never smoke, have disease
df2 %>% filter(BMI == 5 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2 & SMQ020 == 2) #BMI = 5, never smoke, no disease
df2 %>% filter(BMI == 5 & (SMQ040 == 1 | SMQ040 == 2))
df2 %>% filter(BMI == 5 & SMQ040 == 3 & SMQ020 == 1)
df2 %>% filter(BMI == 5 & SMQ020 == 2)
```

#smoke filter
```{r}
df2 %>% filter(SMQ020 == 2) # Never smoke
df2 %>% filter(SMQ020 == 2 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # Never smoke have disease
df2 %>% filter(SMQ020 == 2 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) 

df2 %>% filter(SMQ040 == 1 | SMQ040 == 2)
df2 %>% filter((SMQ040 == 1 | SMQ040 == 2) & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # now smoke have disease
df2 %>% filter((SMQ040 == 1 | SMQ040 == 2) & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) 

df2 %>% filter(SMQ040 == 3  & SMQ020 == 1)
df2 %>% filter(SMQ040 == 3 & SMQ020 == 1 & (MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)) # quit have disease
df2 %>% filter(SMQ040 == 3 & SMQ020 == 1 & MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2) 
```

```{r}
# we can make table like this
library(dplyr)
library(tidyr)

total_ever_disease <- df2 %>%
  filter(MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1)  # Total ever disease

non_case <- df2 %>%
  filter(MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2)  # Non-case

gender_summary <- df2 %>%
  group_by(RIAGENDR) %>%
  summarise(
    TotalEverDisease = sum(MCQ010 == 1 | MCQ160G == 1 | MCQ160K == 1, na.rm = TRUE),
    NonCase = sum(MCQ010 == 2 & MCQ160G == 2 & MCQ160K == 2, na.rm = TRUE),
    Total = n() ) %>%
  mutate(PercentageEverDisease = (TotalEverDisease / Total) * 100,
    PercentageNonCase = (NonCase / Total) * 100)

gender_summary

```


#2-way chi square BMI
```{r}
# create matrix with 2 columns and 5 rows
data= matrix(c(78,295,923,4990,1107,5724,1316,5210,541,1104), ncol=2, byrow=TRUE)
 
# specify the column names and row names of matrix
colnames(data) = c('Ever have respirator disease','None case')
rownames(data) <- c('Under weight','Healthy','Overweight','Obesity', 'Severe obesity')
# assign to table
BMI_dis=as.table(data)

#chi square test
chisq <- chisq.test(BMI_dis)
chisq
round(chisq$residuals,2)
alpha <- .05
alpha_adj <- alpha/(nrow(data)*ncol(data))
t_crit <- qnorm(alpha_adj/2)
```

#2-way chi square BMI group with now smoking
```{r}
data = matrix(c(38,93,290,1011,256,990,306,844,118,178), ncol = 2, byrow = TRUE)

colnames(data) = c('Ever have respirator disease','None case')
rownames(data) <- c('Under weight','Healthy','Overweight','Obesity', 'Severe obesity')

BMI_smoke= as.table(data)

#chi square test
chisq <- chisq.test(BMI_smoke)
chisq
round(chisq$residuals,2)
alpha <- .05
alpa_adj <- alpha/(nrow(data)*ncol(data))
t_crit <- qnorm(alpha_adj/2)
#cohenW(BMI_dis)
```
#2-way chi square BMI group with quit smoking
```{r}
data = matrix(c(17,33,197,890,323,1387,377,1284,156,247), ncol = 2, byrow = TRUE)
colnames(data) = c('Ever have respirator disease','None case')
rownames(data) <- c('Under weight','Healthy','Overweight','Obesity', 'Severe obesity')

BMI_quit= as.table(data)
#chi square test
chisq <- chisq.test(BMI_quit)
chisq
round(chisq$residuals,2)
alpha <- .05
alpha_adj <- alpha/(nrow(data)*ncol(data))
t_crit <- qnorm(alpha_adj/2)
```

```{r}
data = matrix(c(23,169,435,3085,527,3343,632,3076,267,679), ncol = 2, byrow = TRUE)

colnames(data) = c('Ever have respirator disease','None case')
rownames(data) <- c('Under weight','Healthy','Overweight','Obesity', 'Severe obesity')

BMI_Nsmoke= as.table(data)
#chi square test
chisq <- chisq.test(BMI_Nsmoke)
chisq
round(chisq$residuals,2)
```

#2-way chi square Poverty level
```{r}
# create matrix with 2 columns and 5 rows
data= matrix(c(1593,5675,1283,5887,760,4090), ncol=2, byrow=TRUE)
 
# specify the column names and row names of matrix
colnames(data) = c('Ever have respirator disease','None case')
rownames(data) <- c('Low','Medium','High')
# assign to table
PL_dis=as.table(data)

#chi square test
chisq <- chisq.test(PL_dis)
chisq
round(chisq$residuals,2)
alpha <- .05
alpha_adj <- alpha/(nrow(data)*ncol(data))
t_crit <- qnorm(alpha_adj/2)
t_crit
```
#2-way chi square Gender
```{r}
# create matrix with 2 columns and 5 rows
data= matrix(c(1795,8721,2321,8849), ncol=2, byrow=TRUE)
 
# specify the column names and row names of matrix
colnames(data) = c('Ever have respirator disease','None case')
rownames(data) <- c('Male','Female')
# assign to table
gen_dis=as.table(data)

#chi square test
chisq <- chisq.test(gen_dis)
chisq
round(chisq$residuals,2)
alpha <- .05
alpha_adj <- alpha/(nrow(data)*ncol(data))
t_crit <- qnorm(alpha_adj/2)
t_crit
```

#2-way chi square Education Level
```{r}
# create matrix with 2 columns and 5 rows
data= matrix(c(853,3945,922,3874,1398,5226,847,4507), ncol=2, byrow=TRUE)
 
# specify the column names and row names of matrix
colnames(data) = c('Ever have respirator disease','None case')
rownames(data) <- c('Less than High School','High School Graduate','College Graduate','Postgraduate Degree')
# assign to table
Edu_dis=as.table(data)

#chi square test
chisq <- chisq.test(Edu_dis)
chisq
round(chisq$residuals,2)
alpha <- .05
alpha_adj <- alpha/(nrow(data)*ncol(data))
t_crit <- qnorm(alpha_adj/2)
t_crit
```

#2-way chi square Smoking habit
```{r}
# create matrix with 2 columns and 5 rows
data= matrix(c(1030,3157,1087,3913,1906,10485), ncol=2, byrow=TRUE)
 
# specify the column names and row names of matrix
colnames(data) = c('Ever have respirator disease','None case')
rownames(data) <- c('Now smoking','Quit','Never smoking')
# assign to table
smoke_dis=as.table(data)

#chi square test
chisq <- chisq.test(smoke_dis)
chisq
round(chisq$residuals,2)
alpha <- .05
alpha_adj <- alpha/(nrow(data)*ncol(data))
t_crit <- qnorm(alpha_adj/2)
t_crit
```

#logistic regression 
```{r}
df3$is_disease <- factor(df3$is_disease)

#split data
df3.spilt <- sample(1:nrow(df3),size = ceiling(0.80*nrow(df3)),replace = FALSE)
# training set
df3.train <- df3[df3.spilt,]
# test set
df3.test <- df3[-df3.spilt,]

log <- glm(is_disease ~ smoke_ + RIAGENDR + RIDAGEYR + BMXBMI + PLevel_ + edu_, family = "binomial", data = df3.train)

summary(log)
```

```{r}
df3.test$pre_disease <- predict(log, newdata = df3.test, type = "response")
df3.test$pre_disease
```

```{r}
df3.test[,c("is_disease", "RIDAGEYR", "RIAGENDR", "BMXBMI","PLevel_","edu_", "smoke_", "pre_disease")]
```

#Gender smoking disease 3-way table 
```{r}
gender = c("male", "female")
disease = c("have", "non")
s_habit = c("now", "quit", "never")
t_table=expand.grid(disease=disease, s_habit=s_habit, gender=gender)
n = c(484,1954,570,2521,650,4245,546,1203,517,1401,1256,6240)
t_table = cbind(t_table, count=n)
t_table
temp = xtabs(count~disease+s_habit+gender, t_table)
temp
```

```{r}
Frequency=as.vector(margin.table(temp,1))
CumFrequency=cumsum(Frequency)
cbind(disease,Frequency=Frequency,Percentage=Frequency/sum(Frequency),CumFrequency=CumFrequency,CumPercentage=CumFrequency/sum(Frequency))
```

```{r}
Frequency=as.vector(margin.table(temp,2))
CumFrequency=cumsum(Frequency)
cbind(s_habit,Frequency=Frequency,Percentage=Frequency/sum(Frequency),CumFrequency=CumFrequency,CumPercentage=CumFrequency/sum(Frequency))
```

```{r}
Frequency=as.vector(margin.table(temp,3))
CumFrequency=cumsum(Frequency)
cbind(gender,Frequency=Frequency,Percentage=Frequency/sum(Frequency),CumFrequency=CumFrequency,CumPercentage=CumFrequency/sum(Frequency))
```

```{r}
E=array(NA,dim(temp))
for (i in 1:dim(temp)[1]) {
for (j in 1:dim(temp)[2]) {
for (k in 1:dim(temp)[3]) {
E[i,j,k]=(margin.table(temp,3)[k]*margin.table(temp,2)[j]*margin.table(temp,1))[i]/(sum(temp))^2
}}}
E
```


#BMI cleaning (df2$BMXBMI)
```{r}
summary(df2$BMXBMI)
out_BMI <- df2 %>% filter(BMXBMI > (32.9 + 1.5*(32.9-24.3)) | BMXBMI < (24.3 - 1.5*(32.9-24.3)))
valid_BMI <- df2 %>% filter(BMXBMI <= (32.9 + 1.5*(32.9-24.3)) & BMXBMI >= (24.3 - 1.5*(32.9-24.3)))
nrow(out_BMI)
nrow(valid_BMI)
length(boxplot(df2$BMXBMI)$out)

```


#BMI disease smoking group 2-way table
```{r}
BMI_group = c("Under weight", "Healthy", "Overweight", "Obesity", "Sever obesity")
disease = c("have", "non")
s_habit = c("now", "quit", "never")

t_table=expand.grid(disease=disease, s_habit=s_habit, BMI_group=BMI_group)
n = c(38,93,290,1011,256,990,306,844,118,178,17,33,197,890,323,1378,377,1284,156,247,23,169,435,3085,527,3343,632,3076,267,679)
t_table = cbind(t_table, count=n)
t_table
temp_BMI = xtabs(count~disease+s_habit+BMI_group, t_table)
margin.table(margin.table(temp_BMI,3),1)

```

